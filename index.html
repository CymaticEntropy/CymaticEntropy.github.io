<!DOCTYPE html>
<html = style="height: 100%;">
  <head>
    <title>Bear Creek Law Map</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/x-icon" href="icons/law.png">
    <link rel="stylesheet" href="scripts/leaflet.css">
    <script src="scripts/leaflet.js"></script>
    <script src="scripts/Leaflet.Editable.js"></script>
  </head>

  <body style="height: 100%; margin: 0;">
    <div id="map" style="width: 100%; height: 100%; background: #CFB88F;"></div>
    <script type="text/javascript">

      let mapMarkerData;
      let mapOverlayData;

      //Creating the Map
      var map = L.map('map', {editable: true}).setView([0, 0], 0);
      L.tileLayer('map/{z}/{x}/{y}.png', {
        continuousWorld: false,
        noWrap: true,
        minZoom: 2,
        maxZoom: 6,
      }).addTo(map);

      //Coordinate Finder
      var marker = L.marker([-20, 40], {
        draggable: true,
      }).addTo(map);
      marker.bindPopup('LatLng Marker');
      marker.on('dragend', function(e) {
        marker.getPopup().setContent(marker.getLatLng().toString()).openOn(map);
      });

      // Editable Dev Tools
      L.EditControl = L.Control.extend({

        options: {
            position: 'topleft',
            callback: null,
            kind: '',
            html: ''
        },

        onAdd: function (map) {
            var container = L.DomUtil.create('div', 'leaflet-control leaflet-bar'),
                link = L.DomUtil.create('a', '', container);

            link.href = '#';
            link.title = 'Create a new ' + this.options.kind;
            link.innerHTML = this.options.html;
            L.DomEvent.on(link, 'click', L.DomEvent.stop)
                      .on(link, 'click', function () {
                        window.LAYER = this.options.callback.call(map.editTools);
                      }, this);

            return container;
        }

        });

        L.NewLineControl = L.EditControl.extend({

        options: {
            position: 'topleft',
            callback: map.editTools.startPolyline,
            kind: 'line',
            html: '📐'
        }

        });

        L.NewPolygonControl = L.EditControl.extend({

        options: {
            position: 'topleft',
            callback: map.editTools.startPolygon,
            kind: 'polygon',
            html: '🔰'
        }

        });

        L.NewMarkerControl = L.EditControl.extend({

        options: {
            position: 'topleft',
            callback: map.editTools.startMarker,
            kind: 'marker',
            html: '📌'
        }

        });

        L.NewRectangleControl = L.EditControl.extend({

        options: {
            position: 'topleft',
            callback: map.editTools.startRectangle,
            kind: 'rectangle',
            html: '🟦'
        }

        });

        L.NewCircleControl = L.EditControl.extend({

        options: {
            position: 'topleft',
            callback: map.editTools.startCircle,
            kind: 'circle',
            html: '🟣'
        }

      });

      map.addControl(new L.NewMarkerControl());
      map.addControl(new L.NewLineControl());
      map.addControl(new L.NewPolygonControl());
      //map.addControl(new L.NewRectangleControl());
      //map.addControl(new L.NewCircleControl());

      //Icons
      var icon_marshal = L.icon({
        iconUrl:       'icons/marshal.png',
        iconRetinaUrl: 'icons/marshal.png',
        shadowUrl:     'icons/shadow.png',
        iconSize:    [25, 41],
        iconAnchor:  [12, 41],
        popupAnchor: [1, -34],
        tooltipAnchor: [16, -28],
        shadowSize:  [41, 41]
      });

      var icon_ingredient = L.icon({
        iconUrl:       'icons/ingredient.png',
        iconRetinaUrl: 'icons/ingredient.png',
        shadowUrl:     'icons/shadow.png',
        iconSize:    [25, 41],
        iconAnchor:  [12, 41],
        popupAnchor: [1, -34],
        tooltipAnchor: [16, -28],
        shadowSize:  [41, 41]
      });

      var icon_reservation = L.icon({
        iconUrl:       'icons/reservation.png',
        iconRetinaUrl: 'icons/reservation.png',
        shadowUrl:     'icons/shadow.png',
        iconSize:    [25, 41],
        iconAnchor:  [12, 41],
        popupAnchor: [1, -34],
        tooltipAnchor: [16, -28],
        shadowSize:  [41, 41]
      });

      var icon_graveyard = L.icon({
        iconUrl:       'icons/graveyard.png',
        iconRetinaUrl: 'icons/graveyard.png',
        shadowUrl:     'icons/shadow.png',
        iconSize:    [25, 41],
        iconAnchor:  [12, 41],
        popupAnchor: [1, -34],
        tooltipAnchor: [16, -28],
        shadowSize:  [41, 41]
      });

      var icon_campsite = L.icon({
        iconUrl:       'icons/campsite.png',
        iconRetinaUrl: 'icons/campsite.png',
        shadowUrl:     'icons/shadow.png',
        iconSize:    [25, 41],
        iconAnchor:  [12, 41],
        popupAnchor: [1, -34],
        tooltipAnchor: [16, -28],
        shadowSize:  [41, 41]
      });

      var icon_interest = L.icon({
        iconUrl:       'icons/interest.png',
        iconRetinaUrl: 'icons/interest.png',
        shadowUrl:     'icons/shadow.png',
        iconSize:    [25, 41],
        iconAnchor:  [12, 41],
        popupAnchor: [1, -34],
        tooltipAnchor: [16, -28],
        shadowSize:  [41, 41]
      });

      // Marker Points REST API
      fetch('https://script.google.com/macros/s/AKfycbyaz7qfgN_lcoSQwhp2SGpohErVbfyhjxgQTzX9JPNEHok81ruJ3sGJgVKnaj4UR1Q/exec', {
        headers: {
          'Accept': 'application/json'
        }
      })
      .then(response => response.json())
      .then(data => {
        mapMarkerData = data;

        let i = mapMarkerData.data.length
        let marshalarray = [];
        let ingredientarray = [];
        let reservationarray = [];
        let graveyardarray = [];
        let campsitearray = [];
        let interestarray = [];

        for (let v = 0; v < i; v++) {
          let val = mapMarkerData.data[v];
          let category = val.category;
          let unique = val.uniqueIdentifier;
          let xlocation = parseFloat(val.XLocation);
          let ylocation = parseFloat(val.YLocation);
          let name = val.markerName;

          switch (category) {
            case "marshal":
              L.marker([xlocation,ylocation], {icon: icon_marshal, title: name}).bindPopup(name).addTo(map);
              marshalarray.push(unique);
              break;
            case "ingredient":
              L.marker([xlocation,ylocation], {icon: icon_ingredient, title: name}).bindPopup(name).addTo(map);
              ingredientarray.push(unique);
              break;
            case "reservation":
              L.marker([xlocation,ylocation], {icon: icon_reservation, title: name}).bindPopup(name).addTo(map);
              reservationarray.push(unique);
              break;
            case "graveyard":
              L.marker([xlocation,ylocation], {icon: icon_graveyard, title: name}).bindPopup(name).addTo(map);
              graveyardarray.push(unique);
              break;
            case "campsite":
              L.marker([xlocation,ylocation], {icon: icon_campsite, title: name}).bindPopup(name).addTo(map);
              campsitearray.push(unique);
              break;
            case "interest":
              L.marker([xlocation,ylocation], {icon: icon_interest, title: name}).bindPopup(name).addTo(map);
              interestarray.push(unique);
              break;
            default:
              break;
          }
        }

        /*

        // NEED TO ADD THE LATER TOGGLE-ABILITY LATER

        //Marker Groups
        // var marshal = L.layerGroup([marshalarray]);
        // var ingredient = L.layerGroup([ingredientarray]);
        // var reservation = L.layerGroup([reservationarray]);
        // var graveyard = L.layerGroup([graveyardarray]);
        // var campsite = L.layerGroup([campsitearray]);
        // var interest = L.layerGroup([interestarray]);
        var development = L.layerGroup([marker]);

        //Marker Overlay
        var overlays = {
          "Marshal Patrol" : marshal,
          "Ingredients" : ingredient,
          "Reservations" : reservation,
          "Graveyards" : graveyard,
          "Campsites" : campsite,
          "Interests" : interest,
          "Map Dev" : development,
        }

        //GROUP CONTROLS
        L.control.layers(null, overlays).addTo(map);*/
      });
    </script>
  </body>
</html>